<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Libro BIM</title>
    <style>
        body { margin: 0; overflow: hidden; background: #f0f0f0; font-family: sans-serif; }
        #loading {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: white; display: flex; flex-direction: column;
            justify-content: center; align-items: center; z-index: 10;
        }
        .error-msg { color: red; background: #ffdada; padding: 20px; border-radius: 10px; margin-top: 20px; text-align: center; display: none; }
    </style>
    
    <script type="importmap">
        {
            "imports": {
                "web-ifc": "https://unpkg.com/web-ifc@0.0.36/web-ifc-api.js",
                "web-ifc-viewer": "https://unpkg.com/web-ifc-viewer@1.0.217/dist/web-ifc-viewer.js"
            }
        }
    </script>
</head>
<body>

    <div id="loading">
        <h2>Cargando modelo...</h2>
        <div id="error-box" class="error-msg"></div>
    </div>

    <div id="viewer-container" style="width: 100vw; height: 100vh;"></div>

    <script type="module">
        import { IfcViewerAPI } from 'web-ifc-viewer';

        const errorBox = document.getElementById('error-box');
        const container = document.getElementById('viewer-container');
        const viewer = new IfcViewerAPI({ container, backgroundColor: { r: 240, g: 240, b: 240, a: 1 } });
        
        viewer.axes.setAxes();
        viewer.grid.setGrid();

        async function start() {
            // 1. Configurar motor
            await viewer.IFC.setWasmPath('https://unpkg.com/web-ifc@0.0.36/', true);

            // 2. Definir la URL exacta del nuevo archivo
            const url = 'https://almariozamudio-az.github.io/proyecto-casa-libro/casa.ifc';

            try {
                // Verificamos si el archivo existe antes de cargarlo
                const check = await fetch(url);
                if(!check.ok) throw new Error(`No se encuentra el archivo (Error ${check.status}). ¿Seguro que lo renombraste a 'casa.ifc'?`);

                // Cargamos el modelo
                const model = await viewer.IFC.loadIfcUrl(url);
                
                // Si llegamos aquí, todo funcionó
                document.getElementById('loading').style.display = 'none';

            } catch (err) {
                console.error(err);
                errorBox.style.display = 'block';
                errorBox.innerHTML = `<strong>❌ OCURRIÓ UN ERROR:</strong><br>${err.message}`;
            }
        }

        start();
    </script>
</body>
</html>
