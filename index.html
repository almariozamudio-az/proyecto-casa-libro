<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagn√≥stico Libro BIM</title>
    <style>
        body { font-family: sans-serif; margin: 0; overflow: hidden; background: #f0f0f0; }
        #message-box {
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 30px; border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2); text-align: center; max-width: 80%;
            z-index: 10;
        }
        h2 { margin-top: 0; }
        .error { color: red; font-weight: bold; }
        .success { color: green; font-weight: bold; }
        button { margin-top: 15px; padding: 10px 20px; cursor: pointer; }
        #viewer-container { width: 100vw; height: 100vh; }
    </style>
    
    <!-- ImportMap para asegurar versiones compatibles -->
    <script type="importmap">
        {
            "imports": {
                "web-ifc": "https://unpkg.com/web-ifc@0.0.36/web-ifc-api.js",
                "web-ifc-viewer": "https://unpkg.com/web-ifc-viewer@1.0.217/dist/web-ifc-viewer.js"
            }
        }
    </script>
</head>
<body>

    <div id="message-box">
        <h2>Estado del Sistema</h2>
        <p id="status">üîç Buscando archivo 'modelo.ifc'...</p>
        <div id="details" style="font-size: 0.9em; color: #666; margin-top: 10px;"></div>
    </div>

    <div id="viewer-container"></div>

    <script type="module">
        import { IfcViewerAPI } from 'web-ifc-viewer';

        const statusEl = document.getElementById('status');
        const detailsEl = document.getElementById('details');
        const msgBox = document.getElementById('message-box');

        async function start() {
            const container = document.getElementById('viewer-container');
            const viewer = new IfcViewerAPI({ container, backgroundColor: { r: 240, g: 240, b: 240, a: 1 } });
            viewer.axes.setAxes();
            viewer.grid.setGrid();

            // URL EXACTA DE TU ARCHIVO
            const fileUrl = 'https://almariozamudio-az.github.io/proyecto-casa-libro/modelo.ifc';

            try {
                // PASO 1: VERIFICAR SI EL ARCHIVO EXISTE (Diagn√≥stico)
                statusEl.innerText = "üì° Verificando conexi√≥n con el archivo...";
                const response = await fetch(fileUrl);
                
                if (!response.ok) {
                    throw new Error(`‚ùå EL ARCHIVO NO EXISTE (Error ${response.status}).<br>Por favor verifica el nombre en GitHub.`);
                }
                
                detailsEl.innerText = "Archivo encontrado. Iniciando motor 3D...";

                // PASO 2: CARGAR EL MODELO
                await viewer.IFC.setWasmPath('https://unpkg.com/web-ifc@0.0.36/', true);
                
                const model = await viewer.IFC.loadIfcUrl(fileUrl);

                if (!model) {
                    throw new Error("El archivo se descarg√≥ pero el motor 3D devolvi√≥ 'Nulo'. El archivo podr√≠a estar da√±ado o vac√≠o.");
                }

                // √âXITO
                statusEl.innerHTML = "<span class='success'>¬°MODELO CARGADO!</span>";
                detailsEl.innerText = "Cerrando esta ventana en 2 segundos...";
                setTimeout(() => { msgBox.style.display = 'none'; }, 2000);

            } catch (err) {
                statusEl.innerHTML = "<span class='error'>ERROR CR√çTICO</span>";
                detailsEl.innerHTML = err.message;
                console.error(err);
            }
        }

        start();
    </script>
</body>
</html>
